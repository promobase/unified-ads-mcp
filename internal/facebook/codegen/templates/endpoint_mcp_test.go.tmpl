// Code generated by Facebook Business API codegen. DO NOT EDIT.

package {{.PackageName}}

import (
	"context"
	"strings"
	"testing"
	
	"github.com/mark3labs/mcp-go/mcp"{{if or (eq .NodeName "AdAccount") (eq .NodeName "Ad") (eq .NodeName "AdCreative") (eq .NodeName "AdSet") (eq .NodeName "Campaign")}}
	"unified-ads-mcp/internal/shared"{{end}}
)

func TestTool{{capitalizeFirst .Tool.Name}}_Definition(t *testing.T) {
	// Test tool definition
	tool := Tool{{capitalizeFirst .Tool.Name}}()
	if tool.Name != "{{.Tool.Name}}" {
		t.Errorf("expected tool name {{.Tool.Name}}, got %s", tool.Name)
	}
}

func TestTool{{capitalizeFirst .Tool.Name}}_ValidationErrors(t *testing.T) {
	tests := []struct {
		name          string
		arguments     map[string]interface{}
		setupContext  func() context.Context
		expectedError bool
		errorContains string
	}{
		{
			name: "missing access token",
			arguments: map[string]interface{}{
				{{if eq .NodeName "AdAccount"}}"account_id": "123456789",{{end}}
				{{if eq .NodeName "Ad"}}"ad_id": "123456789",{{end}}
				{{if eq .NodeName "AdCreative"}}"ad_creative_id": "123456789",{{end}}
				{{if eq .NodeName "AdSet"}}"ad_set_id": "123456789",{{end}}
				{{if eq .NodeName "Campaign"}}"campaign_id": "123456789",{{end}}
			},
			setupContext: func() context.Context {
				return context.Background() // No token
			},
			expectedError: true,
			errorContains: "access token not found",
		},{{if or (eq .NodeName "AdAccount") (eq .NodeName "Ad") (eq .NodeName "AdCreative") (eq .NodeName "AdSet") (eq .NodeName "Campaign")}}
		{
			name: "missing required ID parameter",
			arguments: map[string]interface{}{
				// Missing required ID
			},
			setupContext: func() context.Context {
				return context.WithValue(context.Background(), shared.FacebookAccessTokenKey, "test-token")
			},
			expectedError: true,
			errorContains: "missing required parameter",
		},{{end}}
	}
	
	for _, tt := range tests {
		t.Run(tt.name, func(t *testing.T) {
			// Setup context
			ctx := tt.setupContext()
			
			// Create request
			params := mcp.CallToolParams{
				Name:      "{{.Tool.Name}}",
				Arguments: tt.arguments,
			}
			request := mcp.CallToolRequest{
				Params: params,
			}
			
			// Call handler
			result, err := Handle{{capitalizeFirst .Tool.Name}}(ctx, request)
			
			// Check expectations
			if tt.expectedError {
				if err != nil {
					t.Fatalf("unexpected error type: %v", err)
				}
				if result == nil || !result.IsError {
					t.Fatal("expected error result")
				}
				
				// Check error message contains expected text
				if tt.errorContains != "" && len(result.Content) > 0 {
					// Try to extract text from content
					errorText := ""
					for _, content := range result.Content {
						if textContent, ok := content.(mcp.TextContent); ok {
							errorText = textContent.Text
							break
						}
					}
					if errorText != "" && !strings.Contains(errorText, tt.errorContains) {
						t.Errorf("error %q does not contain %q", errorText, tt.errorContains)
					}
				}
			}
		})
	}
}